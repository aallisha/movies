{% extends 'movies/index.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
    <main class="content">
        <div class="single">

            <section class="trailer">
                <h3>Trailer</h3>
                <div class="trailer_frame">
                    <iframe width="100%" height="100%" src="{{ object.trailer_link }}" frameborder="1"
                            allowfullscreen></iframe>
                </div>
            </section>

            <section class="movie">
                <img src="{{ object.image.url }}">
                <ul class="hello">
                    <li>{{ object.title }}</li>
                    <li>{{ object.description }}</li>
                    <li><a href="/movies/genre/{{ object.genre }}">{{ object.genre }}</a></li>
                    <li>
                          {% for actor in actors %}
                              <a href="/movies/cast/{{ actor.actor_slug }}">{{ actor.actor_name }} </a>
                          {% endfor %}
                    </li>
                    <li>Rating: <b>{{ object.rating }}/5</b></li>
                    <li>{{ object.views }} views</li>
                    <li><a href="#">Watch</a></li>
                </ul>

            </section>
            <section class="comments">
                <h3>Comments ({{ comments.count }})</h3>
                <div class="row">
                    <div class="col-md-8 card mb-4  mt-3 ">
                        <div class="card-body">
                            {% for comment in comments %}
                                <div class="comments" style="padding: 10px;">
                                  <p class="font-weight-bold">
                                    {{ comment.name }}
                                  </p>
                                  {{ comment.body | linebreaks }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-md-8 card mb-4  mt-3 ">
                        <div class="card-body">
                                {% if user.is_authenticated %}
                                    {% comment %} if the user has just posted a comment,
                                    then they don't need to see the form {% endcomment %}
                                    {% if messages %}
                                        <div class="content-section">
                                            {% for message in messages %}
                                                <div class="alert alert-{{ message.tags }}">
                                                {{ message }}
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="content-section">
                                            <form method="post">
                                                {% csrf_token %}
                                                <fieldset class="form-group">
                                                    <legend class="border-bottom mb-4"><h3>Leave a comment</h3></legend>
                                                    {{ comment_form | crispy }}
                                                </fieldset>
                                                <div class="form-group">
                                                    <button class="btn btn-outline-info" type="submit">Post</button>
                                                </div>
                                            </form>
                                    {% endif %}
                                {% else %}
                                    <a style="margin-top: 1.3em;" href="{% url 'login' %}">Login to comment</a>
                                {% endif %}
                        </div>
                    </div>
            </section>

            <section class="related" style="margin-top:20px;">
                <h3>Related movies</h3>
                {% for movie in related_movies %}
                    <div class="relatemovie">
                        <a href="#"><img src="{{ movie.image.url }}"></a>
                        <a href="#"><span class="relatedname">{{ movie.title }}</span></a>
                    </div>
                {% endfor %}
            </section>

        </div>
    </main>

{% endblock content %}
